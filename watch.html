<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Watch – All in 1st</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet" />
</head>
<body>
  <nav class="navbar navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="index.html">All in 1st</a>
      <button class="btn btn-outline-danger" onclick="logout()">Logout</button>
    </div>
  </nav>
  <div id="loading" class="d-flex vh-100 vw-100 align-items-center justify-content-center">
    <div>
      <div class="spinner-border mb-2"></div>
      <div>Verifying login…</div>
    </div>
  </div>
  <div class="container py-5 d-none" id="content">
    <h1>Video Library</h1>
    <div class="row" id="videos"></div>
  </div>

  <script>
    // Session helpers
    function getSession() {
      try {
        return JSON.parse(localStorage.getItem('allin1st_session') || 'null');
      } catch { return null; }
    }
    function isLoggedIn() {
      const s = getSession();
      return s && s.isLoggedIn;
    }
    function logout() {
      localStorage.removeItem('allin1st_session');
      location.href = 'login.html?next=watch.html';
    }

    async function init() {
      // Short delay to show spinner
      await new Promise(r => setTimeout(r, 300));
      if (!isLoggedIn()) {
        return location.href = 'login.html?next=watch.html';
      }
      document.getElementById('loading').classList.add('d-none');
      document.getElementById('content').classList.remove('d-none');
      loadVideos();
    }

    function loadVideos() {
      const data = [
        { id:1, title:'Dragon Ball Z Explained', genre:'Action'},
        { id:2, title:'Fairy Tail Fantasy', genre:'Fantasy'}
      ];
      const container = document.getElementById('videos');
      container.innerHTML = data.map(v =>
        `<div class="col-md-4 mb-3">
           <div class="card p-3" onclick="play(${v.id})">
             <h5>${v.title}</h5>
             <span class="badge bg-primary">${v.genre}</span>
           </div>
         </div>`
      ).join('');
    }

    function play(id) {
      // If logged out mid-session, redirect preserving click
      if (!isLoggedIn()) {
        return location.href = `login.html?next=watch.html`;
      }
      alert('Now playing video #' + id);
    }

    window.addEventListener('load', init);
  </script>
</body>
</html>
