<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - All in 1st</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
    .login-card { background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
  </style>
</head>
<body class="d-flex align-items-center justify-content-center">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-4">
        <div class="login-card p-4">
          <h2 class="text-center mb-4">Welcome Back</h2>
          
          <div id="alert"></div>
          
          <form id="loginForm">
            <div class="mb-3">
              <label class="form-label">Username</label>
              <input type="text" id="username" class="form-control" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Password</label>
              <input type="password" id="password" class="form-control" required>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" id="rememberMe" class="form-check-input">
              <label class="form-check-label" for="rememberMe">Remember me</label>
            </div>
            <button type="submit" class="btn btn-primary w-100">
              <span id="btnText">Sign In</span>
              <div class="spinner-border spinner-border-sm ms-2 d-none" id="spinner"></div>
            </button>
          </form>
          
          <hr class="my-3">
          
          <button class="btn btn-outline-primary w-100" onclick="demoLogin()">
            Demo Login (demo/demo123)
          </button>
          
          <div class="text-center mt-3">
            <small class="text-muted">
              Admin: admin/allin1st2025 | Demo: demo/demo123
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const users = {
      'admin': { username: 'admin', password: 'allin1st2025', role: 'admin' },
      'demo': { username: 'demo', password: 'demo123', role: 'user' }
    };

    function showAlert(message, type = 'danger') {
      document.getElementById('alert').innerHTML = 
        `<div class="alert alert-${type} alert-dismissible fade show">
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>`;
    }

    function saveSession(user, remember) {
      const session = {
        username: user.username,
        role: user.role,
        isLoggedIn: true,
        timestamp: Date.now()
      };
      
      if (remember) {
        localStorage.setItem('allin1st_session', JSON.stringify(session));
      } else {
        sessionStorage.setItem('allin1st_session', JSON.stringify(session));
      }
      console.log('Session saved:', session);
    }

    function demoLogin() {
      document.getElementById('username').value = 'demo';
      document.getElementById('password').value = 'demo123';
      document.getElementById('loginForm').requestSubmit();
    }

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const remember = document.getElementById('rememberMe').checked;
      
      const btnText = document.getElementById('btnText');
      const spinner = document.getElementById('spinner');
      
      btnText.textContent = 'Signing in...';
      spinner.classList.remove('d-none');
      
      // Simulate loading
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const user = users[username];
      
      if (user && user.password === password) {
        saveSession(user, remember);
        showAlert(`Welcome ${user.username}!`, 'success');
        
        setTimeout(() => {
          const redirect = new URLSearchParams(window.location.search).get('next') || 'watch.html';
          window.location.href = redirect;
        }, 1000);
      } else {
        showAlert('Invalid username or password');
        btnText.textContent = 'Sign In';
        spinner.classList.add('d-none');
      }
    });
    
    // Check if already logged in
    const existingSession = localStorage.getItem('allin1st_session') || sessionStorage.getItem('allin1st_session');
    if (existingSession) {
      try {
        const session = JSON.parse(existingSession);
        if (session.isLoggedIn) {
          showAlert('Already logged in. Redirecting...', 'info');
          setTimeout(() => window.location.href = 'watch.html', 1500);
        }
      } catch (e) {
        // Invalid session data, clear it
        localStorage.removeItem('allin1st_session');
        sessionStorage.removeItem('allin1st_session');
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
