<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Upload â€“ All in 1st</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet" />
</head>
<body>
  <nav class="navbar navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="watch.html">All in 1st</a>
      <button class="btn btn-outline-secondary" onclick="location.href='watch.html'">
        Back to Watch
      </button>
    </div>
  </nav>

  <div class="container py-5">
    <h2>Upload Your Video</h2>
    <form id="uploadForm">
      <div class="mb-3">
        <label class="form-label">Video Title</label>
        <input type="text" id="title" class="form-control" required />
      </div>
      <div class="mb-3">
        <label class="form-label">YouTube Video Link</label>
        <input type="url" id="link" class="form-control" required />
      </div>
      <div class="mb-3">
        <label class="form-label">Tags (comma-separated)</label>
        <input type="text" id="tags" class="form-control" placeholder="e.g. Action, Fantasy" />
      </div>
      <div class="mb-3">
        <label class="form-label">Short Description</label>
        <textarea id="description" class="form-control" rows="3"></textarea>
      </div>
      <button type="submit" class="btn btn-primary">
        Submit
      </button>
    </form>
  </div>

  <script>
    // Ensure user is logged in
    const session = JSON.parse(localStorage.getItem('allin1st_session')||'null');
    if (!session || !session.isLoggedIn) {
      return location.href = 'login.html?next=upload.html';
    }

    // Load existing uploads
    let uploads = JSON.parse(localStorage.getItem('videosUploaded')||'[]');

    document.getElementById('uploadForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const title       = document.getElementById('title').value.trim();
      const link        = document.getElementById('link').value.trim();
      const tagsInput   = document.getElementById('tags').value.trim();
      const description = document.getElementById('description').value.trim();

      // Basic validation
      if (!title || !link) {
        return alert('Title and link are required.');
      }

      // Extract YouTube ID from link
      const match = link.match(/(?:v=|youtu\.be\/)([A-Za-z0-9_-]{11})/);
      if (!match) {
        return alert('Enter a valid YouTube URL.');
      }

      const youtubeId = match[1];
      const tags      = tagsInput ? tagsInput.split(',').map(t => t.trim()) : [];

      // Create new video object
      const newVideo = {
        id: Date.now(),
        title,
        genre: tags[0] || 'Uncategorized',
        description,
        youtubeId,
        tags,
        uploadDate: new Date().toISOString(),
        views: 0
      };

      // Save to localStorage
      uploads.unshift(newVideo);
      localStorage.setItem('videosUploaded', JSON.stringify(uploads));

      alert('Video submitted successfully!');
      // Redirect back to watch page so gallery can show it
      location.href = 'watch.html';
    });
  </script>
</body>
</html>
